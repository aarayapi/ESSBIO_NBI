-- View: owd.vmt_1705_1151_sewerline

-- DROP MATERIALIZED VIEW IF EXISTS owd.vmt_1705_1151_sewerline;

CREATE MATERIALIZED VIEW IF NOT EXISTS owd.vmt_1705_1151_sewerline
TABLESPACE pg_default
AS
 SELECT sd.objectid,
    sd.assetgroup,
    sd.assettype,
    sd.associationstatus,
    sd.isconnected,
    sd.fromdeviceterminal,
    sd.todeviceterminal,
    sd.creationdate,
    sd.creator,
    sd.lastupdate,
    sd.updatedby,
    sd.globalid,
    sd.cpsubnetworkname,
    sd.supportedsubnetworkname,
    sd.systemsubnetworkname,
    sd.sewershedsubnetworkname,
    sd.supportingsubnetworkname,
    sd.diameter,
    sd.linertype,
    sd.downelev,
    sd.upelev,
    sd.slope,
    sd.lifecyclestatus,
    sd.installdate,
    sd.assetid,
    sd.ownedby,
    sd.maintby,
    sd.tracerwire,
    sd.measuredlength,
    sd.notes,
    sd.spatialsource,
    sd.spatialconfidence,
    sd.cptraceability,
    sd.cpoverride,
    sd.material,
    sd.bondedinsulated,
    sd.mainshape,
    sd.nombre_conduccion,
    sd.codigo_financiamiento,
    sd.periodo_informado_siss,
    sd.anio_instalacion,
    sd.proyecto_informado_siss,
    sd.codigo_sistema_siss,
    sd.red_tipo_cliente,
    sd.tipo_red,
    sd.uso_red,
    sd.porcentaje_napa,
    sd.presion_maxima_trabajo,
    sd.profundidad_media_tramo,
    sd.tipo_operacion,
    sd.tipo_terreno,
    sd.descripcion_proceso,
    sd.codigo_grilla,
    sd.tipo_difusor,
    sd.numero_toberas,
    sd.largo_difusor,
    sd.ancho_zona_proteccion_litoral,
    sd.etapa,
    sd.codigo_localidad,
    sd.codigo_comuna,
    sd.codigo_subcuenca,
    sd.codigo_area_tributaria,
    sd.tipo_financiamiento,
    sd.codigo_obra,
    sd.codigo_duplicidad,
    sd.otro_material_tuberia,
    sd.justificacion_duplicidad,
    sd.tipo_obra_red,
    sd.id_troncal,
    sd.id_tramo_conectado,
    sd.id_inventario_ultima_edicion,
    sd.id_inventario,
    sd.fecha_ultima_edicion,
    sd.codigo_obra_diseno,
    sd.design_type,
    sd.tipo_obra_origen,
    sd.codigo_obra_origen,
    sd.tipo_obra_destino,
    sd.codigo_obra_destino,
    sd.tipo_tramo,
    sd.paralelo,
    sd.proyecto_ultima_edicion,
    sd.otro_tipo_difusor,
    sd.shape,
    sd.gdb_from_date,
    sd.gdb_is_delete,
    sd.gdb_archive_oid
   FROM ( SELECT sd_1.objectid,
            sd_1.assetgroup,
            sd_1.assettype,
            sd_1.associationstatus,
            sd_1.isconnected,
            sd_1.fromdeviceterminal,
            sd_1.todeviceterminal,
            sd_1.creationdate,
            sd_1.creator,
            sd_1.lastupdate,
            sd_1.updatedby,
            sd_1.globalid,
            sd_1.cpsubnetworkname,
            sd_1.supportedsubnetworkname,
            sd_1.systemsubnetworkname,
            sd_1.sewershedsubnetworkname,
            sd_1.supportingsubnetworkname,
            sd_1.diameter,
            sd_1.linertype,
            sd_1.downelev,
            sd_1.upelev,
            sd_1.slope,
            sd_1.lifecyclestatus,
            sd_1.installdate,
            sd_1.assetid,
            sd_1.ownedby,
            sd_1.maintby,
            sd_1.tracerwire,
            sd_1.measuredlength,
            sd_1.notes,
            sd_1.spatialsource,
            sd_1.spatialconfidence,
            sd_1.cptraceability,
            sd_1.cpoverride,
            sd_1.material,
            sd_1.bondedinsulated,
            sd_1.mainshape,
            sd_1.nombre_conduccion,
            sd_1.codigo_financiamiento,
            sd_1.periodo_informado_siss,
            sd_1.anio_instalacion,
            sd_1.proyecto_informado_siss,
            sd_1.codigo_sistema_siss,
            sd_1.red_tipo_cliente,
            sd_1.tipo_red,
            sd_1.uso_red,
            sd_1.porcentaje_napa,
            sd_1.presion_maxima_trabajo,
            sd_1.profundidad_media_tramo,
            sd_1.tipo_operacion,
            sd_1.tipo_terreno,
            sd_1.descripcion_proceso,
            sd_1.codigo_grilla,
            sd_1.tipo_difusor,
            sd_1.numero_toberas,
            sd_1.largo_difusor,
            sd_1.ancho_zona_proteccion_litoral,
            sd_1.etapa,
            sd_1.codigo_localidad,
            sd_1.codigo_comuna,
            sd_1.codigo_subcuenca,
            sd_1.codigo_area_tributaria,
            sd_1.tipo_financiamiento,
            sd_1.codigo_obra,
            sd_1.codigo_duplicidad,
            sd_1.otro_material_tuberia,
            sd_1.justificacion_duplicidad,
            sd_1.tipo_obra_red,
            sd_1.id_troncal,
            sd_1.id_tramo_conectado,
            sd_1.id_inventario_ultima_edicion,
            sd_1.id_inventario,
            sd_1.fecha_ultima_edicion,
            sd_1.codigo_obra_diseno,
            sd_1.design_type,
            sd_1.tipo_obra_origen,
            sd_1.codigo_obra_origen,
            sd_1.tipo_obra_destino,
            sd_1.codigo_obra_destino,
            sd_1.tipo_tramo,
            sd_1.paralelo,
            sd_1.proyecto_ultima_edicion,
            sd_1.otro_tipo_difusor,
            sd_1.shape,
            sd_1.gdb_from_date,
            sd_1.gdb_is_delete,
            sd_1.gdb_archive_oid
           FROM sewerline sd_1
          WHERE (sd_1.gdb_archive_oid IN ( SELECT mb_.gdb_archive_oid
                   FROM ( SELECT sewerline.gdb_archive_oid,
                            row_number() OVER (PARTITION BY sewerline.objectid ORDER BY sewerline.gdb_from_date DESC) AS rn,
                            sewerline.gdb_is_delete
                           FROM sewerline
                          WHERE sewerline.gdb_branch_id = 0 AND sewerline.gdb_from_date <= '9999-12-31 23:59:59'::timestamp without time zone) mb_
                  WHERE mb_.rn = 1))) sd
WITH DATA;

ALTER TABLE IF EXISTS owd.vmt_1705_1151_sewerline
    OWNER TO owd;

GRANT ALL ON TABLE owd.vmt_1705_1151_sewerline TO owd;
GRANT ALL ON TABLE owd.vmt_1705_1151_sewerline TO bd_consulta;