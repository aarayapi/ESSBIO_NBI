-- View: owd.vmt_waterdevice_sb

-- DROP MATERIALIZED VIEW IF EXISTS owd.vmt_waterdevice_sb;

CREATE MATERIALIZED VIEW IF NOT EXISTS owd.vmt_waterdevice_sb
TABLESPACE pg_default
AS
 SELECT wd.objectid,
    wd.assetgroup,
    wd.assettype,
    wd.associationstatus,
    wd.issubnetworkcontroller,
    wd.isconnected,
    wd.subnetworkcontrollername,
    wd.tiername,
    wd.tierrank,
    wd.terminalconfiguration,
    wd.creationdate,
    wd.creator,
    wd.lastupdate,
    wd.updatedby,
    wd.globalid,
    wd.cpsubnetworkname,
    wd.supportedsubnetworkname,
    wd.systemsubnetworkname,
    wd.pressuresubnetworkname,
    wd.isolationsubnetworkname,
    wd.dmasubnetworkname,
    wd.diameter,
    wd.secondarydiameter,
    wd.pressure,
    wd.designtype,
    wd.normalstatus,
    wd.presentstatus,
    wd.additionaldetails,
    wd.designinfo,
    wd.operable,
    wd.name,
    wd.installdate,
    wd.assetid,
    wd.accountid,
    wd.ownedby,
    wd.maintby,
    wd.additionaldevice,
    wd.notes,
    wd.symbolrotation,
    wd.lastmaint,
    wd.lifecyclestatus,
    wd.bondedinsulated,
    wd.cptraceability,
    wd.inservicedate,
    wd.retireddate,
    wd.spatialsource,
    wd.spatialconfidence,
    wd.cpoverride,
    wd.manufacturer,
    wd.operator,
    wd.codigo_financiamiento,
    wd.periodo_informado_siss,
    wd.anio_construccion,
    wd.proyecto_informado_siss,
    wd.codigo_sistema_siss,
    wd.tipo_terreno,
    wd.etapa,
    wd.codigo_localidad,
    wd.codigo_comuna,
    wd.codigo_cuartel,
    wd.tipo_financiamiento,
    wd.codigo_obra,
    wd.id_troncal,
    wd.id_tramo_conectado,
    wd.id_inventario_ultima_edicion,
    wd.id_inventario,
    wd.fecha_ultima_edicion,
    wd.codigo_sector_distribucion,
    wd.codigo_obra_diseno,
    wd.cota,
    wd.numero_total_bombas,
    wd.numero_bombas_reserva,
    wd.potencia_instalada,
    wd.telemetria,
    wd.telecontrol,
    wd.utm_norte_sig,
    wd.utm_este_sig,
    wd.codigo_obra_asociada,
    wd.diferencial_medio_presion,
    wd.diferencial_maximo_presion,
    wd.seccion_rio,
    wd.desarenador,
    wd.tipo_captacion,
    wd.otro,
    wd.longitud_barrera_dren_presa,
    wd.capacidad_operativa,
    wd.fuente,
    wd.altura_agua,
    wd.caudal_total,
    wd.material_marcopartidor_presa,
    wd.ancho_presa,
    wd.profundidad,
    wd.capacidad_embalse_explotacion,
    wd.num_punteras_totales,
    wd.profundidad_total_pozo,
    wd.codigo_recinto,
    wd.material_estanque,
    wd.tipo_estanque,
    wd.tipo_tecnologia_clo,
    wd.tipo_tecnologia_flu,
    wd.cota_terreno_sig,
    wd.otro_etapa_obra_asociada,
    wd.tipo,
    wd.tipo_obra_asociada,
    wd.volumen,
    wd.coagulacion_floculacion,
    wd.sedimentador,
    wd.sistema_filtracion,
    wd.tipo_unidad,
    wd.tipo_sector_red_conduccion,
    wd.simple_doble,
    wd.cantidad_cliente,
    wd.ubicacion,
    wd.codigo_sector_presion,
    wd.proyecto_ultima_edicion,
    wd.sector_calidad,
    wd.zona_riesgo,
    wd.utm_norte_nbi,
    wd.utm_este_nbi,
    wd.shape,
    wd.gdb_branch_id,
    wd.gdb_from_date,
    wd.gdb_is_delete,
    wd.gdb_deleted_at,
    wd.gdb_deleted_by,
    wd.gdb_archive_oid,
	wd.ancho_presa_double
   FROM waterdevice wd
  WHERE (wd.gdb_archive_oid IN ( SELECT mb_.gdb_archive_oid
           FROM ( SELECT waterdevice.gdb_archive_oid,
                    row_number() OVER (PARTITION BY waterdevice.objectid ORDER BY waterdevice.gdb_from_date DESC) AS rn,
                    waterdevice.gdb_is_delete
                   FROM waterdevice
                  WHERE waterdevice.gdb_branch_id = 0 AND waterdevice.gdb_from_date <= '9999-12-31 23:59:59'::timestamp without time zone) mb_
          WHERE mb_.rn = 1 AND mb_.gdb_is_delete = '0'::smallint))
WITH DATA;

ALTER TABLE IF EXISTS owd.vmt_waterdevice_sb
    OWNER TO owd;

GRANT ALL ON TABLE owd.vmt_waterdevice_sb TO owd;
GRANT SELECT ON TABLE owd.vmt_waterdevice_sb TO psanhueza;
GRANT SELECT ON TABLE owd.vmt_waterdevice_sb TO bd_consulta;