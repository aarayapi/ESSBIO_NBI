-- View: owd.view_101

-- DROP VIEW owd.view_101;

CREATE OR REPLACE VIEW owd.view_101
 AS
 SELECT '5'::text AS "codigoProceso",
    '101'::text AS "codigoArchivo",
        CASE wd.ownedby
            WHEN 103 THEN '76833300'::text
            WHEN 104 THEN '96963440'::text
            ELSE NULL::text
        END AS rut,
    (date_part('year'::text, CURRENT_DATE) - 1::double precision) || '12'::text AS periodo,
    wd.codigo_sistema_siss AS "codigoSistema",
    wd.codigo_obra AS "codigoObra",
    wd.name AS "NombreObra",
    wd.anio_construccion AS "AnioConstruccion",
        CASE
            WHEN wd.lifecyclestatus = 8 THEN 1
            WHEN wd.lifecyclestatus = 256 THEN 2
            WHEN wd.lifecyclestatus = 32 THEN 3
            WHEN wd.lifecyclestatus = 260 THEN 4
            WHEN wd.lifecyclestatus = 259 THEN 5
            WHEN wd.lifecyclestatus = 261 THEN 6
            ELSE NULL::integer
        END AS "EstadoUso",
    wd.seccion_rio AS "SeccionRio",
    wd.fuente AS "CodigoFuente",
    round(wd.cota, 2) AS "Cota",
    wd.desarenador AS "Desarenador",
    round(wd.designinfo, 2) AS "CaudalDisenio",
        CASE
            WHEN wd.tipo_captacion = 1 THEN 1
            WHEN wd.tipo_captacion = 2 THEN 2
            WHEN wd.tipo_captacion = 3 THEN 3
            WHEN wd.tipo_captacion = 6 THEN 4
            ELSE NULL::integer
        END AS "TipoCaptacion",
    wd.otro AS "OtroTipoCaptacion",
        CASE
            WHEN wd.longitud_barrera_dren_presa = '-100'::integer::numeric THEN round(wd.longitud_barrera_dren_presa, 0)
            ELSE round(wd.longitud_barrera_dren_presa, 2)
        END AS "LongitudBarrera",
        CASE
            WHEN wd.diameter = '-100'::integer::numeric THEN round(wd.diameter, 0)
            ELSE round(wd.diameter, 2)
        END AS "AlturaBarrera",
    round(wd.capacidad_operativa, 2) AS "CapacidadOperativa",
    wd.telemetria AS "Telemetria",
    wd.telecontrol AS "Telecontrol",
    round(wd.utm_norte_sig, 2) AS "UTMNorte",
    round(wd.utm_este_sig, 2) AS "UTMEste",
    wd.creationdate,
    wd.codigo_recinto
   FROM vmt_waterdevice_sb wd
  WHERE wd.assetgroup = 20 AND wd.assettype = 567;

ALTER TABLE owd.view_101
    OWNER TO owd;

GRANT ALL ON TABLE owd.view_101 TO owd;
GRANT SELECT ON TABLE owd.view_101 TO psanhueza;
GRANT SELECT ON TABLE owd.view_101 TO bd_consulta;

