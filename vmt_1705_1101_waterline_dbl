-- View: owd.vmt_1705_1101_waterline_dbl

-- DROP MATERIALIZED VIEW IF EXISTS owd.vmt_1705_1101_waterline_dbl;

CREATE MATERIALIZED VIEW IF NOT EXISTS owd.vmt_1705_1101_waterline_dbl
TABLESPACE pg_default
AS
 SELECT cm.objectid,
    cm.assetgroup,
    cm.assettype,
    cm.associationstatus,
    cm.isconnected,
    cm.fromdeviceterminal,
    cm.todeviceterminal,
    cm.creationdate,
    cm.creator,
    cm.lastupdate,
    cm.updatedby,
    cm.cpsubnetworkname,
    cm.supportedsubnetworkname,
    cm.systemsubnetworkname,
    cm.pressuresubnetworkname,
    cm.isolationsubnetworkname,
    cm.dmasubnetworkname,
    cm.installdate,
    cm.assetid,
    cm.ownedby,
    cm.maintby,
    cm.notes,
    cm.diameter,
    cm.measuredlength,
    cm.adddetails,
    cm.lifecyclestatus,
    cm.bondedinsulated,
    cm.cptraceability,
    cm.inservicedate,
    cm.retireddate,
    cm.material,
    cm.cpoverride,
    cm.designtype,
    cm.spatialsource,
    cm.spatialconfidence,
    cm.nombre_conduccion,
    cm.codigo_financiamiento,
    cm.periodo_informado_siss,
    cm.anio_instalacion,
    cm.proyecto_informado_siss,
    cm.codigo_sistema_siss,
    cm.red_tipo_cliente,
    cm.tipo_red,
    cm.uso_red,
    cm.porcentaje_napa,
    cm.presion_maxima_trabajo,
    cm.tipo_operacion,
    cm.tipo_terreno,
    cm.descripcion_proceso,
    cm.etapa,
    cm.codigo_localidad,
    cm.codigo_comuna,
    cm.tipo_financiamiento,
    cm.codigo_obra,
    cm.codigo_duplicidad,
    cm.justificacion_duplicidad,
    cm.metodo_rehabilitacion,
    cm.id_troncal,
    cm.id_tramo_conectado,
    cm.id_inventario_ultima_edicion,
    cm.id_inventario,
    cm.fecha_ultima_edicion,
    cm.codigo_sector_distribucion,
    cm.codigo_cuartel,
    cm.codigo_obra_diseno,
    cm.codigo_sector_presion,
    cm.tipo_obra_origen,
    cm.codigo_obra_origen,
    cm.tipo_obra_destino,
    cm.codigo_obra_destino,
    cm.proyecto_ultima_edicion,
    cm.profundidad_media_tramo,
    cm.tipo_obra_red,
    cm.paralelo,
    cm.otro,
    cm.gdb_archive_oid,
    cm.gdb_from_date
   FROM dblink('dbname=prd_ap port=5432 host=10.56.209.135 user=owd password=E55b10$2021'::text, ' 
 SELECT wl.objectid,
    wl.assetgroup,
    wl.assettype,
    wl.associationstatus,
    wl.isconnected,
    wl.fromdeviceterminal,
    wl.todeviceterminal,
    wl.creationdate,
    wl.creator,
    wl.lastupdate,
    wl.updatedby,
    wl.cpsubnetworkname,
    wl.supportedsubnetworkname,
    wl.systemsubnetworkname,
    wl.pressuresubnetworkname,
    wl.isolationsubnetworkname,
    wl.dmasubnetworkname,
    wl.installdate,
    wl.assetid,
    wl.ownedby,
    wl.maintby,
    wl.notes,
    wl.diameter,
    wl.measuredlength,
    wl.adddetails,
    wl.lifecyclestatus,
    wl.bondedinsulated,
    wl.cptraceability,
    wl.inservicedate,
    wl.retireddate,
    wl.material,
    wl.cpoverride,
    wl.designtype,
    wl.spatialsource,
    wl.spatialconfidence,
    wl.nombre_conduccion,
    wl.codigo_financiamiento,
    wl.periodo_informado_siss,
    wl.anio_instalacion,
    wl.proyecto_informado_siss,
    wl.codigo_sistema_siss,
    wl.red_tipo_cliente,
    wl.tipo_red,
    wl.uso_red,
    wl.porcentaje_napa,
    wl.presion_maxima_trabajo,
    wl.tipo_operacion,
    wl.tipo_terreno,
    wl.descripcion_proceso,
    wl.etapa,
    wl.codigo_localidad,
    wl.codigo_comuna,
    wl.tipo_financiamiento,
    wl.codigo_obra,
    wl.codigo_duplicidad,
    wl.justificacion_duplicidad,
    wl.metodo_rehabilitacion,
    wl.id_troncal,
    wl.id_tramo_conectado,
    wl.id_inventario_ultima_edicion,
    wl.id_inventario,
    wl.fecha_ultima_edicion,
    wl.codigo_sector_distribucion,
    wl.codigo_cuartel,
    wl.codigo_obra_diseno,
    wl.codigo_sector_presion,
    wl.tipo_obra_origen,
    wl.codigo_obra_origen,
    wl.tipo_obra_destino,
    wl.codigo_obra_destino,
    wl.proyecto_ultima_edicion,
    wl.profundidad_media_tramo,
    wl.tipo_obra_red,
    wl.paralelo,
    wl.otro,
	wl.gdb_archive_oid,
	wl.gdb_from_date
   FROM waterline wl
  WHERE wl.proyecto_informado_siss is not null AND wl.measuredlength is not null AND (wl.gdb_archive_oid IN ( SELECT mb_.gdb_archive_oid
           FROM ( SELECT waterline.gdb_archive_oid,
                    row_number() OVER (PARTITION BY waterline.objectid ORDER BY waterline.gdb_from_date DESC) AS rn,
                    waterline.gdb_is_delete
                   FROM waterline
                  WHERE waterline.gdb_branch_id = 0 AND waterline.gdb_from_date <= ''9999-12-31 23:59:59''::timestamp without time zone) mb_
          WHERE mb_.rn = 1))'::text) cm(objectid integer, assetgroup integer, assettype smallint, associationstatus smallint, isconnected smallint, fromdeviceterminal smallint, todeviceterminal smallint, creationdate timestamp without time zone, creator character varying(255), lastupdate timestamp without time zone, updatedby character varying(255), cpsubnetworkname character varying(2000), supportedsubnetworkname character varying(2000), systemsubnetworkname character varying(2000), pressuresubnetworkname character varying(2000), isolationsubnetworkname character varying(2000), dmasubnetworkname character varying(2000), installdate timestamp without time zone, assetid character varying(64), ownedby smallint, maintby smallint, notes character varying(2000), diameter numeric(38,8), measuredlength numeric(38,8), adddetails smallint, lifecyclestatus smallint, bondedinsulated smallint, cptraceability smallint, inservicedate timestamp without time zone, retireddate timestamp without time zone, material smallint, cpoverride smallint, designtype smallint, spatialsource smallint, spatialconfidence smallint, nombre_conduccion character varying(60), codigo_financiamiento character varying(50), periodo_informado_siss integer, anio_instalacion integer, proyecto_informado_siss character varying(255), codigo_sistema_siss integer, red_tipo_cliente integer, tipo_red integer, uso_red integer, porcentaje_napa numeric(38,8), presion_maxima_trabajo numeric(38,8), tipo_operacion integer, tipo_terreno integer, descripcion_proceso character varying(255), etapa integer, codigo_localidad integer, codigo_comuna integer, tipo_financiamiento integer, codigo_obra character varying(255), codigo_duplicidad character varying(255), justificacion_duplicidad character varying(255), metodo_rehabilitacion character varying(255), id_troncal character varying(255), id_tramo_conectado character varying(255), id_inventario_ultima_edicion integer, id_inventario integer, fecha_ultima_edicion timestamp without time zone, codigo_sector_distribucion character varying(125), codigo_cuartel character varying(255), codigo_obra_diseno character varying(255), codigo_sector_presion character varying(255), tipo_obra_origen integer, codigo_obra_origen character varying(255), tipo_obra_destino integer, codigo_obra_destino character varying(255), proyecto_ultima_edicion character varying(255), profundidad_media_tramo numeric(38,8), tipo_obra_red integer, paralelo integer, otro character varying(255), gdb_archive_oid integer, gdb_from_date timestamp without time zone)
WITH DATA;

ALTER TABLE IF EXISTS owd.vmt_1705_1101_waterline_dbl
    OWNER TO owd;

GRANT ALL ON TABLE owd.vmt_1705_1101_waterline_dbl TO owd;
GRANT SELECT ON TABLE owd.vmt_1705_1101_waterline_dbl TO bd_consulta;