-- View: owd.vmt_1705_502_waterdevice_dbl

-- DROP MATERIALIZED VIEW IF EXISTS owd.vmt_1705_502_waterdevice_dbl;

CREATE MATERIALIZED VIEW IF NOT EXISTS owd.vmt_1705_502_waterdevice_dbl
TABLESPACE pg_default
AS
 SELECT cm.objectid,
    cm.assetgroup,
    cm.assettype,
    cm.associationstatus,
    cm.issubnetworkcontroller,
    cm.isconnected,
    cm.subnetworkcontrollername,
    cm.tiername,
    cm.tierrank,
    cm.terminalconfiguration,
    cm.creationdate,
    cm.creator,
    cm.lastupdate,
    cm.updatedby,
    cm.globalid,
    cm.cpsubnetworkname,
    cm.supportedsubnetworkname,
    cm.systemsubnetworkname,
    cm.pressuresubnetworkname,
    cm.isolationsubnetworkname,
    cm.dmasubnetworkname,
    cm.diameter,
    cm.secondarydiameter,
    cm.pressure,
    cm.designtype,
    cm.normalstatus,
    cm.presentstatus,
    cm.additionaldetails,
    cm.designinfo,
    cm.operable,
    cm.name,
    cm.installdate,
    cm.assetid,
    cm.accountid,
    cm.ownedby,
    cm.maintby,
    cm.additionaldevice,
    cm.notes,
    cm.symbolrotation,
    cm.lastmaint,
        CASE
            WHEN cm.lifecyclestatus = 8 THEN 1
            WHEN cm.lifecyclestatus = 256 THEN 2
            WHEN cm.lifecyclestatus = 32 THEN 3
            WHEN cm.lifecyclestatus = 260 THEN 4
            WHEN cm.lifecyclestatus = 259 THEN 5
            WHEN cm.lifecyclestatus = 261 THEN 6
            ELSE NULL::integer
        END AS lifecyclestatus,
    cm.bondedinsulated,
    cm.cptraceability,
    cm.inservicedate,
    cm.retireddate,
    cm.spatialsource,
    cm.spatialconfidence,
    cm.cpoverride,
    cm.manufacturer,
    cm.operator,
    cm.codigo_financiamiento,
    cm.periodo_informado_siss,
    cm.anio_construccion,
    cm.proyecto_informado_siss,
    cm.codigo_sistema_siss,
    cm.tipo_terreno,
    cm.etapa,
    cm.codigo_localidad,
    cm.codigo_comuna,
    cm.codigo_cuartel,
    cm.tipo_financiamiento,
    cm.codigo_obra,
    cm.id_troncal,
    cm.id_tramo_conectado,
    cm.id_inventario_ultima_edicion,
    cm.id_inventario,
    cm.fecha_ultima_edicion,
    cm.codigo_sector_distribucion,
    cm.codigo_obra_diseno,
    cm.cota,
    cm.numero_total_bombas,
    cm.numero_bombas_reserva,
    cm.potencia_instalada,
    cm.telemetria,
    cm.telecontrol,
    cm.utm_norte_sig,
    cm.utm_este_sig,
    cm.codigo_obra_asociada,
    cm.diferencial_medio_presion,
    cm.diferencial_maximo_presion,
    cm.seccion_rio,
    cm.desarenador,
    cm.tipo_captacion,
    cm.otro,
    cm.longitud_barrera_dren_presa,
    cm.capacidad_operativa,
    cm.fuente,
    cm.altura_agua,
    cm.caudal_total,
    cm.material_marcopartidor_presa,
    cm.ancho_presa,
    cm.profundidad,
    cm.capacidad_embalse_explotacion,
    cm.num_punteras_totales,
    cm.profundidad_total_pozo,
    cm.codigo_recinto,
    cm.material_estanque,
    cm.tipo_estanque,
    cm.tipo_tecnologia_clo,
    cm.tipo_tecnologia_flu,
    cm.cota_terreno_sig,
    cm.otro_etapa_obra_asociada,
    cm.tipo,
    cm.tipo_obra_asociada,
    cm.volumen,
    cm.coagulacion_floculacion,
    cm.sedimentador,
    cm.sistema_filtracion,
    cm.tipo_unidad,
    cm.tipo_sector_red_conduccion,
    cm.simple_doble,
    cm.cantidad_cliente,
    cm.ubicacion,
    cm.codigo_sector_presion,
    cm.proyecto_ultima_edicion,
    cm.sector_calidad,
    cm.zona_riesgo,
    cm.utm_norte_nbi,
    cm.utm_este_nbi,
    cm.shape,
    cm.gdb_branch_id,
    cm.gdb_from_date,
    cm.gdb_is_delete,
    cm.gdb_deleted_at,
    cm.gdb_deleted_by,
    cm.gdb_archive_oid
   FROM dblink('dbname=prd_ap port=5432 host=10.56.209.135 user=owd password=E55b10$2021'::text, ' 
 SELECT 
wd.objectid, 
wd.assetgroup, 
wd.assettype, 
wd.associationstatus, 
wd.issubnetworkcontroller, 
wd.isconnected, 
wd.subnetworkcontrollername, 
wd.tiername, 
wd.tierrank, 
wd.terminalconfiguration, 
wd.creationdate, 
wd.creator, 
wd.lastupdate, 
wd.updatedby, 
wd.globalid, 
wd.cpsubnetworkname, 
wd.supportedsubnetworkname, 
wd.systemsubnetworkname, 
wd.pressuresubnetworkname, 
wd.isolationsubnetworkname, 
wd.dmasubnetworkname, 
wd.diameter, 
wd.secondarydiameter, 
wd.pressure, 
wd.designtype, 
wd.normalstatus, 
wd.presentstatus, 
wd.additionaldetails, 
wd.designinfo, 
wd.operable, 
wd.name, 
wd.installdate, 
wd.assetid, 
wd.accountid, 
wd.ownedby, 
wd.maintby, 
wd.additionaldevice, 
wd.notes, 
wd.symbolrotation, 
wd.lastmaint, 
wd.lifecyclestatus, 
wd.bondedinsulated, 
wd.cptraceability, 
wd.inservicedate, 
wd.retireddate, 
wd.spatialsource, 
wd.spatialconfidence, 
wd.cpoverride, 
wd.manufacturer, 
wd.operator, 
wd.codigo_financiamiento, 
wd.periodo_informado_siss, 
wd.anio_construccion, 
wd.proyecto_informado_siss, 
wd.codigo_sistema_siss, 
wd.tipo_terreno, 
wd.etapa, 
wd.codigo_localidad, 
wd.codigo_comuna, 
wd.codigo_cuartel, 
wd.tipo_financiamiento, 
wd.codigo_obra, 
wd.id_troncal, 
wd.id_tramo_conectado, 
wd.id_inventario_ultima_edicion, 
wd.id_inventario, 
wd.fecha_ultima_edicion, 
wd.codigo_sector_distribucion, 
wd.codigo_obra_diseno, 
wd.cota, 
wd.numero_total_bombas, 
wd.numero_bombas_reserva, 
wd.potencia_instalada, 
wd.telemetria, 
wd.telecontrol, 
wd.utm_norte_sig, 
wd.utm_este_sig, 
wd.codigo_obra_asociada, 
wd.diferencial_medio_presion, 
wd.diferencial_maximo_presion, 
wd.seccion_rio, 
wd.desarenador, 
wd.tipo_captacion, 
wd.otro, 
wd.longitud_barrera_dren_presa, 
wd.capacidad_operativa, 
wd.fuente, 
wd.altura_agua, 
wd.caudal_total, 
wd.material_marcopartidor_presa, 
wd.ancho_presa, 
wd.profundidad, 
wd.capacidad_embalse_explotacion, 
wd.num_punteras_totales, 
wd.profundidad_total_pozo, 
wd.codigo_recinto, 
wd.material_estanque, 
wd.tipo_estanque, 
wd.tipo_tecnologia_clo, 
wd.tipo_tecnologia_flu, 
wd.cota_terreno_sig, 
wd.otro_etapa_obra_asociada, 
wd.tipo, 
wd.tipo_obra_asociada, 
wd.volumen, 
wd.coagulacion_floculacion, 
wd.sedimentador, 
wd.sistema_filtracion, 
wd.tipo_unidad, 
wd.tipo_sector_red_conduccion, 
wd.simple_doble, 
wd.cantidad_cliente, 
wd.ubicacion, 
wd.codigo_sector_presion, 
wd.proyecto_ultima_edicion, 
wd.sector_calidad, 
wd.zona_riesgo, 
wd.utm_norte_nbi, 
wd.utm_este_nbi, 
wd.shape, 
wd.gdb_branch_id, 
wd.gdb_from_date, 
wd.gdb_is_delete, 
wd.gdb_deleted_at, 
wd.gdb_deleted_by,
wd.gdb_archive_oid
FROM owd.waterdevice wd 
     
  WHERE wd.gdb_branch_id = 0 AND wd.objectid in (select distinct wd1.objectid from waterdevice wd1 where wd1.creationdate != wd1.lastupdate)
   
 AND wd.assettype = 607 AND wd.assetgroup = 15'::text) cm(objectid integer, assetgroup integer, assettype smallint, associationstatus smallint, issubnetworkcontroller smallint, isconnected smallint, subnetworkcontrollername character varying(2000), tiername integer, tierrank integer, terminalconfiguration character varying(128), creationdate timestamp without time zone, creator character varying(255), lastupdate timestamp without time zone, updatedby character varying(255), globalid character varying(38), cpsubnetworkname character varying(2000), supportedsubnetworkname character varying(2000), systemsubnetworkname character varying(2000), pressuresubnetworkname character varying(2000), isolationsubnetworkname character varying(2000), dmasubnetworkname character varying(2000), diameter numeric(38,8), secondarydiameter numeric(38,8), pressure numeric(38,8), designtype smallint, normalstatus smallint, presentstatus smallint, additionaldetails smallint, designinfo numeric(38,8), operable smallint, name character varying(64), installdate timestamp without time zone, assetid character varying(64), accountid character varying(50), ownedby smallint, maintby smallint, additionaldevice smallint, notes character varying(2000), symbolrotation smallint, lastmaint timestamp without time zone, lifecyclestatus smallint, bondedinsulated smallint, cptraceability smallint, inservicedate timestamp without time zone, retireddate timestamp without time zone, spatialsource smallint, spatialconfidence smallint, cpoverride smallint, manufacturer smallint, operator smallint, codigo_financiamiento character varying(50), periodo_informado_siss integer, anio_construccion integer, proyecto_informado_siss character varying(255), codigo_sistema_siss integer, tipo_terreno integer, etapa integer, codigo_localidad integer, codigo_comuna integer, codigo_cuartel character varying(255), tipo_financiamiento integer, codigo_obra character varying(255), id_troncal character varying(255), id_tramo_conectado character varying(255), id_inventario_ultima_edicion integer, id_inventario integer, fecha_ultima_edicion timestamp without time zone, codigo_sector_distribucion character varying(125), codigo_obra_diseno character varying(255), cota numeric(38,8), numero_total_bombas integer, numero_bombas_reserva integer, potencia_instalada numeric(38,8), telemetria integer, telecontrol integer, utm_norte_sig numeric(38,8), utm_este_sig numeric(38,8), codigo_obra_asociada character varying(255), diferencial_medio_presion numeric(38,8), diferencial_maximo_presion numeric(38,8), seccion_rio integer, desarenador integer, tipo_captacion integer, otro character varying(255), longitud_barrera_dren_presa numeric(38,8), capacidad_operativa numeric(38,8), fuente character varying(255), altura_agua numeric(38,8), caudal_total numeric(38,8), material_marcopartidor_presa character varying(255), ancho_presa integer, profundidad numeric(38,8), capacidad_embalse_explotacion numeric(38,8), num_punteras_totales integer, profundidad_total_pozo numeric(38,8), codigo_recinto character varying(20), material_estanque integer, tipo_estanque integer, tipo_tecnologia_clo integer, tipo_tecnologia_flu integer, cota_terreno_sig numeric(38,8), otro_etapa_obra_asociada character varying(255), tipo integer, tipo_obra_asociada integer, volumen numeric(38,8), coagulacion_floculacion integer, sedimentador integer, sistema_filtracion integer, tipo_unidad integer, tipo_sector_red_conduccion integer, simple_doble integer, cantidad_cliente integer, ubicacion character varying(255), codigo_sector_presion character varying(255), proyecto_ultima_edicion character varying(255), sector_calidad character varying(10), zona_riesgo integer, utm_norte_nbi numeric(38,8), utm_este_nbi numeric(38,8), shape st_point, gdb_branch_id integer, gdb_from_date timestamp without time zone, gdb_is_delete smallint, gdb_deleted_at timestamp without time zone, gdb_deleted_by character varying(255), gdb_archive_oid integer)
WITH DATA;

ALTER TABLE IF EXISTS owd.vmt_1705_502_waterdevice_dbl
    OWNER TO owd;

GRANT ALL ON TABLE owd.vmt_1705_502_waterdevice_dbl TO owd;
GRANT SELECT ON TABLE owd.vmt_1705_502_waterdevice_dbl TO psanhueza;
GRANT SELECT ON TABLE owd.vmt_1705_502_waterdevice_dbl TO bd_consulta;